<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم المدير - النظام الذكي</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="admin-brand">
                <h2><i class="fas fa-user-shield"></i> لوحة المدير</h2>
                <div class="admin-info">
                    <span>مدير النظام</span>
                    <small>مسؤول كامل الصلاحيات</small>
                </div>
            </div>
            <nav class="admin-nav">
                <a href="#dashboard" class="admin-nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    الإحصائيات
                </a>
                <a href="#ai-control" class="admin-nav-link">
                    <i class="fas fa-robot"></i>
                    الذكاء الاصطناعي
                </a>
                <a href="#code-editor" class="admin-nav-link">
                    <i class="fas fa-code"></i>
                    محرر الأكواد
                </a>
                <a href="#file-manager" class="admin-nav-link">
                    <i class="fas fa-folder"></i>
                    مدير الملفات
                </a>
                <a href="#system-tools" class="admin-nav-link">
                    <i class="fas fa-tools"></i>
                    أدوات النظام
                </a>
            </nav>
            <div class="admin-actions">
                <button class="btn btn-secondary w-100" onclick="adminManager.logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    تسجيل الخروج
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Quick Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="systemHealth">100%</div>
                    <div class="stat-label">صحة النظام</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="issuesCount">0</div>
                    <div class="stat-label">مشاكل مكتشفة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="optimizations">0</div>
                    <div class="stat-label">تحسينات مقترحة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="aiStatus">🟢</div>
                    <div class="stat-label">حالة الـ AI</div>
                </div>
            </div>

            <!-- AI Control Center -->
            <div class="admin-ai-dashboard">
                <!-- AI Analysis -->
                <div class="ai-analysis-card">
                    <h3><i class="fas fa-chart-line"></i> تحليل النظام</h3>
                    <div class="analysis-results" id="analysisResults">
                        <p>لم يتم إجراء أي تحليل بعد</p>
                    </div>
                    <div class="ai-tools-grid">
                        <button class="ai-tool-btn" onclick="adminManager.runFullAnalysis()">
                            <i class="fas fa-search"></i>
                            فحص كامل
                        </button>
                        <button class="ai-tool-btn" onclick="adminManager.autoFixAll()">
                            <i class="fas fa-magic"></i>
                            إصلاح تلقائي
                        </button>
                        <button class="ai-tool-btn" onclick="adminManager.optimizeSystem()">
                            <i class="fas fa-bolt"></i>
                            تحسين الأداء
                        </button>
                    </div>
                </div>

                <!-- AI Assistant -->
                <div class="ai-analysis-card">
                    <h3><i class="fas fa-robot"></i> المساعد المتقدم</h3>
                    <div class="ai-chat-mini">
                        <div class="ai-messages-mini" id="aiMessagesMini">
                            <div class="ai-message bot">
                                أنا جاهز لمساعدتك في أي شيء!
                            </div>
                        </div>
                        <div class="ai-input-mini">
                            <input type="text" id="aiInputMini" placeholder="اسأل AI عن أي شيء...">
                            <button onclick="adminManager.askAI()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Editor -->
            <div class="admin-section">
                <h3><i class="fas fa-code"></i> محرر الأكواد المتقدم</h3>
                <div class="code-editor">
                    <div class="editor-header">
                        <span>script.js</span>
                        <div class="editor-actions">
                            <button class="btn btn-sm" onclick="adminManager.formatCode()">
                                <i class="fas fa-align-left"></i>
                                تنسيق
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="adminManager.saveCode()">
                                <i class="fas fa-save"></i>
                                حفظ
                            </button>
                        </div>
                    </div>
                    <textarea class="editor-content" id="codeEditor" spellcheck="false">
// اكتب أو عدل الأكواد هنا
// المساعد AI سيساعدك في كتابة كود احترافي

function advancedFeature() {
    console.log('ميزة متقدمة تعمل!');
    return 'نجاح';
}
                    </textarea>
                </div>
            </div>

            <!-- File Manager -->
            <div class="admin-section">
                <h3><i class="fas fa-file-upload"></i> رفع ومعالجة الملفات</h3>
                <div class="file-upload-area" onclick="document.getElementById('fileUploadAdmin').click()">
                    <i class="fas fa-cloud-upload-alt fa-3x"></i>
                    <p>انقر لرفع الملفات أو اسحبها هنا</p>
                    <small>يدعم جميع أنواع الملفات</small>
                </div>
                <input type="file" id="fileUploadAdmin" hidden multiple onchange="adminManager.handleFiles(this.files)">
                <div class="uploaded-files" id="uploadedFiles"></div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script src="ai-assistant.js"></script>
    <script>
        class AdminManager {
            constructor() {
                this.aiAssistant = new AdvancedAIAssistant();
                this.init();
            }

            init() {
                this.checkAdminAccess();
                this.loadSystemInfo();
                this.setupAI();
            }

            checkAdminAccess() {
                if (!localStorage.getItem('admin_session')) {
                    window.location.href = 'index.html';
                    return;
                }
            }

            async loadSystemInfo() {
                const analysis = await this.aiAssistant.quickAnalysis();
                this.updateDashboard(analysis);
            }

            updateDashboard(analysis) {
                document.getElementById('systemHealth').textContent = analysis.healthScore + '%';
                document.getElementById('issuesCount').textContent = analysis.issues.length;
                document.getElementById('optimizations').textContent = analysis.recommendations.length;
            }

            async runFullAnalysis() {
                const analysis = await this.aiAssistant.comprehensiveAnalysis();
                this.displayAnalysis(analysis);
                this.updateDashboard(analysis);
            }

            displayAnalysis(analysis) {
                const resultsDiv = document.getElementById('analysisResults');
                resultsDiv.innerHTML = `
                    <div class="analysis-item">
                        <strong>صحة النظام:</strong> ${analysis.healthScore}%
                    </div>
                    <div class="analysis-item">
                        <strong>المشاكل:</strong> ${analysis.issues.length}
                    </div>
                    <div class="analysis-item">
                        <strong>التحسينات:</strong> ${analysis.recommendations.length}
                    </div>
                `;
            }

            async autoFixAll() {
                const results = await this.aiAssistant.autoFixAll();
                alert(`تم إصلاح ${results.fixed} مشكلة تلقائياً`);
                this.loadSystemInfo();
            }

            async optimizeSystem() {
                const optimization = await this.aiAssistant.optimizeSystem();
                alert('تم تحسين النظام بنجاح');
                this.loadSystemInfo();
            }

            async askAI() {
                const input = document.getElementById('aiInputMini');
                const message = input.value.trim();
                
                if (!message) return;

                const response = await this.aiAssistant.askUnrestricted(message);
                this.displayAIResponse(response);
                input.value = '';
            }

            displayAIResponse(response) {
                const messagesDiv = document.getElementById('aiMessagesMini');
                const userMsg = document.createElement('div');
                userMsg.className = 'ai-message user';
                userMsg.textContent = response.question;
                messagesDiv.appendChild(userMsg);

                const botMsg = document.createElement('div');
                botMsg.className = 'ai-message bot';
                botMsg.innerHTML = response.answer;
                messagesDiv.appendChild(botMsg);

                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }

            handleFiles(files) {
                const filesDiv = document.getElementById('uploadedFiles');
                filesDiv.innerHTML = '';

                Array.from(files).forEach(file => {
                    const fileElement = document.createElement('div');
                    fileElement.className = 'file-item';
                    fileElement.innerHTML = `
                        <i class="fas fa-file"></i>
                        <span>${file.name}</span>
                        <small>(${(file.size / 1024).toFixed(2)} KB)</small>
                        <button onclick="adminManager.processFile(this)" data-file="${file.name}">
                            <i class="fas fa-cog"></i>
                        </button>
                    `;
                    filesDiv.appendChild(fileElement);
                });
            }

            async processFile(button) {
                const fileName = button.getAttribute('data-file');
                const response = await this.aiAssistant.processFile(fileName);
                alert(`تم معالجة الملف: ${response.result}`);
            }

            formatCode() {
                // تنسيق الكود تلقائياً
                const editor = document.getElementById('codeEditor');
                // يمكن إضافة مكتبة تنسيق الكود هنا
            }

            async saveCode() {
                const code = document.getElementById('codeEditor').value;
                const result = await this.aiAssistant.analyzeCode(code);
                
                if (result.valid) {
                    alert('تم حفظ الكود بنجاح');
                    // حفظ الكود في النظام
                } else {
                    alert('يوجد أخطاء في الكود: ' + result.errors.join(', '));
                }
            }

            logout() {
                localStorage.removeItem('admin_session');
                window.location.href = 'index.html';
            }
        }

        const adminManager = new AdminManager();
    </script>
</body>
</html>
