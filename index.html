<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>صفحة التقييمات — تجربة</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --glass: rgba(255,255,255,0.03);
      --success:#10b981; --danger:#ef4444;
      --radius:12px;
      font-family: "Segoe UI", Tahoma, "Noto Naskh Arabic", system-ui, -apple-system, sans-serif;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%, #081226 60%);color:#e6eef6}
    .wrap{max-width:980px;margin:36px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .card{background:linear-gradient(180deg,var(--card), rgba(8,12,20,0.6));border-radius:var(--radius);padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    @media(max-width:880px){.grid{grid-template-columns:1fr}}
    .reviews-list{display:flex;flex-direction:column;gap:12px}
    .review{background:var(--glass);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);display:flex;gap:12px;align-items:flex-start}
    .avatar{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021018}
    .meta{flex:1}
    .meta .name{font-weight:700}
    .meta .time{font-size:12px;color:var(--muted)}
    .stars{display:inline-block;margin-top:6px}
    .stars span{font-size:14px;margin-left:4px}
    .comment{margin-top:8px;color:#dbeafe}
    form{display:flex;flex-direction:column;gap:10px}
    input[type="text"], textarea, select{
      background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit;font-size:14px
    }
    textarea{min-height:100px;resize:vertical}
    .btn{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:#001219;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:13px;color:var(--muted)}
    .summary{display:flex;gap:12px;align-items:center}
    .big-rating{font-size:36px;font-weight:800;color:#ffd166}
    .stat{font-size:13px;color:var(--muted)}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:13px;border:1px solid rgba(255,255,255,0.02)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="card" style="padding:12px;display:flex;gap:12px;align-items:center">
        <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:900;color:#021018">Rv</div>
        <div>
          <h1>نظام التقييمات — صفحة عرض واختبار</h1>
          <div class="small">واجهة تجريبية لحث العملاء على إضافة مراجعات حقيقية — آمنة للاختبار</div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- العمود الأيسر: قائمة المراجعات -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div class="summary">
            <div class="big-rating" id="avgRating">4.6</div>
            <div>
              <div class="chip" id="totalCount">5 مراجعات</div>
              <div class="stat" style="margin-top:8px" id="positiveCount">4 تقييمات إيجابية</div>
            </div>
          </div>
          <div class="actions">
            <button class="btn ghost" id="seedBtn" title="توليد مراجعات تجريبية">توليد 5 مراجعين تجريبيين</button>
            <button class="btn" id="clearBtn" title="مسح المراجعات">مسح</button>
          </div>
        </div>

        <div class="reviews-list" id="reviewsList">
          <!-- المراجعات ستُضاف هنا ديناميكياً -->
        </div>
      </section>

      <!-- العمود الأيمن: نموذج الإضافة -->
      <aside class="card">
        <h3>أضف مراجعتك</h3>
        <form id="reviewForm" autocomplete="off">
          <input type="text" id="nameInput" placeholder="اسمك (أو اتركه فارغًا لاسم عشوائي)" />
          <label class="small">التقييم:</label>
          <select id="ratingInput">
            <option value="5">★★★★★ - ممتاز</option>
            <option value="4">★★★★ - جيد جداً</option>
            <option value="3">★★★ - مقبول</option>
            <option value="2">★★ - ضعيف</option>
            <option value="1">★ - سيئ</option>
          </select>
          <textarea id="commentInput" placeholder="اكتب تعليقًا محترمًا وواقعيًا عن المنتج..."></textarea>
          <div style="display:flex;gap:8px">
            <button class="btn" type="submit">نشر المراجعة</button>
            <button class="btn ghost" type="button" id="previewBtn">معاينة</button>
          </div>
          <div class="small" style="margin-top:8px">نستخدم التخزين المحلي لحفظ المراجعات في متصفحك (localStorage). هذه الصفحة للاختبار أو كنموذج <strong>قانوني</strong> لجمع مراجعات حقيقية.</div>
        </form>
      </aside>
    </div>

    <footer>
      ✨ تلميح: استخدم زر "توليد 5 مراجعين" لملء الصفحة بأمثلة واقعية للاختبار — لا تستخدمها لنشر مراجعات وهمية على مواقع خارجية.
    </footer>
  </div>

  <script>
    // بيانات اسماء وتعليقات مبدئية (عربية واقعية)
    const demoNames = [
      "محمد أحمد","أحمد خالد","خالد إبراهيم","إبراهيم حسن","حسن محمود",
      "محمود علي","علي عمر","عمر ناصر","ناصر سعيد","سعيد راشد",
      "فاطمة محمد","سارة أحمد","نورة خالد","لمى إبراهيم","هدى حسن"
    ];

    const demoComments = {
      "electronics": [
        "جهاز رائع وجودة تصنيعه ممتازة، أنصح به بشدة",
        "تجاوز توقعاتي، الأداء سريع والبطارية تدوم طويلاً",
        "جيد جداً وسعره معقول، لكن يمكن تحسين بعض الميزات",
        "منتج عملي ويناسب احتياجاتي اليومية، شكراً للجودة",
        "مقبول ولكن هناك بعض المشاكل الصغيرة في البرنامج"
      ],
      "clothing": [
        "القماش ممتاز والتفصيل متقن، يناسب المقاس تماماً",
        "جيد جداً ولكن الألوان تختلف قليلاً عن الصورة",
        "أنيق ومريح، الجودة أعلى من التوقعات",
        "مناسب للسعر، ولكن يمكن تحسين خامة القماش",
        "شكراً للتوصيل السريع، المنتج رائع وأنصح الجميع به"
      ]
    };

    // تحميل/حفظ من localStorage
    const STORAGE_KEY = "demo_reviews_v1";
    function loadReviews(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){
        console.error(e);
        return [];
      }
    }
    function saveReviews(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      renderReviews();
    }

    // إنشاء عنصر مراجعة في DOM
    function createReviewElement(r){
      const el = document.createElement("div");
      el.className = "review";
      el.innerHTML = `
        <div class="avatar">${(r.name||"مستخدم").split(" ")[0].slice(0,2)}</div>
        <div class="meta">
          <div><span class="name">${escapeHtml(r.name||"مجهول')}</span> · <span class="time">${r.time}</span></div>
          <div class="stars">${starsHtml(r.rating)}</div>
          <div class="comment">${escapeHtml(r.comment)}</div>
        </div>
      `;
      return el;
    }

    function starsHtml(rating){
      let s = "";
      for(let i=0;i<rating;i++) s += "★";
      for(let i=rating;i<5;i++) s += "☆";
      return `<span style="color:#ffd166">${s}</span>`;
    }

    function escapeHtml(text){
      return String(text).replace(/[&<>"']/g, (m)=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
    }

    // عرض المراجعات
    function renderReviews(){
      const list = loadReviews();
      const container = document.getElementById("reviewsList");
      container.innerHTML = "";
      // أحدث أولاً
      list.slice().reverse().forEach(r => container.appendChild(createReviewElement(r)));

      // إحصائيات
      const total = list.length;
      const avg = total ? (list.reduce((a,b)=>a+b.rating,0)/total) : 0;
      const positive = list.filter(x=>x.rating>=4).length;
      document.getElementById("avgRating").textContent = avg ? avg.toFixed(1) : "0.0";
      document.getElementById("totalCount").textContent = `${total} مراجعة${total!==1 ? "ات":""}`;
      document.getElementById("positiveCount").textContent = `${positive} تقييم${positive!==1 ? "ات":""} إيجابية`;
    }

    // توليد مراجعات تجريبية (خمسة أشخاص)
    function seedDemoReviews(){
      const list = loadReviews();
      const now = Date.now();
      for(let i=0;i<5;i++){
        const name = demoNames[Math.floor(Math.random()*demoNames.length)];
        const type = Math.random() > .5 ? "electronics" : "clothing";
        const commentPool = demoComments[type];
        const comment = commentPool[Math.floor(Math.random()*commentPool.length)];
        const rating = [5,5,4,4,3][Math.floor(Math.random()*5)];
        list.push({
          name, rating, comment,
          time: new Date(now - i*3600*1000).toLocaleString("ar-EG")
        });
      }
      saveReviews(list);
    }

    // التعامل مع النموذج
    document.getElementById("reviewForm").addEventListener("submit", (e)=>{
      e.preventDefault();
      const name = document.getElementById("nameInput").value.trim() || demoNames[Math.floor(Math.random()*demoNames.length)];
      const rating = parseInt(document.getElementById("ratingInput").value,10) || 5;
      const comment = document.getElementById("commentInput").value.trim();
      if(!comment || comment.length < 6){ alert("اكتب تعليقًا حقيقيًا على الأقل 6 أحرف."); return; }

      const list = loadReviews();
      list.push({
        name, rating, comment,
        time: new Date().toLocaleString("ar-EG")
      });
      saveReviews(list);
      // إعادة تعيين الحقول
      document.getElementById("commentInput").value = "";
      document.getElementById("ratingInput").value = "5";
      document.getElementById("nameInput").value = "";
      // إشارة نجاح صغيرة
      alert("تم نشر المراجعة — شكرًا لمساهمتك الحقيقية!");
    });

    // معاينة
    document.getElementById("previewBtn").addEventListener("click", ()=>{
      const name = document.getElementById("nameInput").value.trim() || "اسم تجريبي";
      const rating = parseInt(document.getElementById("ratingInput").value,10) || 5;
      const comment = document.getElementById("commentInput").value.trim() || "هذا نص معاينة للتعليق.";
      const preview = createReviewElement({name, rating, comment, time: new Date().toLocaleString("ar-EG")});
      // نافذة معاينة بسيطة
      const w = window.open("", "_blank", "width=420,height=360");
      if(w){
        w.document.write(`<html><head><meta charset="utf-8"><title>معاينة المراجعة</title></head><body style="background:#071029;color:#e6eef6;font-family:sans-serif;padding:16px">${preview.outerHTML}</body></html>`);
        w.document.close();
      }else alert("المنبثق محظور - افتح صفحة جديدة يدوياً لمعاينة.");
    });

    // أزرار توليد ومسح
    document.getElementById("seedBtn").addEventListener("click", ()=>{
      if(confirm("هل تريد توليد 5 مراجعين تجريبيين في هذه الصفحة؟ (للاختبار فقط)")) seedDemoReviews();
    });
    document.getElementById("clearBtn").addEventListener("click", ()=>{
      if(confirm("سيتم مسح كل المراجعات المخزنة محلياً. هل متابعة؟")){
        localStorage.removeItem(STORAGE_KEY);
        renderReviews();
      }
    });

    // تهيئة أولية: إذا لا توجد مراجعات، نضع 5 أمثلة افتراضية
    (function init(){
      if(!localStorage.getItem(STORAGE_KEY)){
        // نموذج أولي: 5 مراجعات واقعية للعرض
        const samples = [
          {name:"سامر حسن", rating:5, comment:"جهاز رائع وجودة تصنيعه ممتازة، أنصح به بشدة", time:new Date().toLocaleString("ar-EG")},
          {name:"لمياء علي", rating:4, comment:"اشتريت المنتج للاستخدام المنزلي، الجودة كويسة، التركيب كان سهل.", time:new Date().toLocaleString("ar-EG")},
          {name:"أحمد خالد", rating:5, comment:"خفيف وسريع ومناسب للتنقل. الصوت واضح.", time:new Date().toLocaleString("ar-EG")},
          {name:"نور سعيد", rating:4, comment:"التصميم شيك ويمسك الانتباه، لكن الألوان تختلف قليلاً.", time:new Date().toLocaleString("ar-EG")},
          {name:"كريم محمود", rating:3, comment:"المنتج يؤدي الغرض ولكن واجهت مشكلة مع التغليف.", time:new Date().toLocaleString("ar-EG")}
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(samples));
      }
      renderReviews();
    })();
  </script>
</body>
</html>
